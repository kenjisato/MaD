\usepackage{listings}
\usepackage{caption}

\makeatletter
\gdef\lst@frameExit{%
    \lst@frameSpreadV\lst@framexbottommargin
    \lst@frameH B\lst@framebshape
    \ifvoid\z@\else
        \everypar{}\par\nobreak\lst@parshape\nointerlineskip\noindent\box\z@
    \fi}
\makeatother

\definecolor{fgcolor}{rgb}{0,0,0}
%\definecolor{shadecolor}{rgb}{1,1,1}
\definecolor{codecolor}{rgb}{0.97,0.97,0.97}

\lstdefinestyle{Source}{%
  language={Python},
  basicstyle={\linespread{1.0}\small\ttfamily},%
  identifierstyle={\small},%
  commentstyle={\small\itshape},%
  keywordstyle={\small\bfseries},%
  ndkeywordstyle={\small},%
  stringstyle={\small\ttfamily},
  backgroundcolor=\color{codecolor},
  frame={tb},
  framerule=0.3pt,
  breaklines=false,
  columns=[l]{fullflexible},%
  xrightmargin=0\zw,%
  xleftmargin=3\zw,%
  numberstyle={\scriptsize},%
  numbers=left,%
  stepnumber=5,
  firstnumber=1,
  numbersep=3ex,
  framesep=3pt,
  framextopmargin=0pt,
  framexleftmargin=1.5ex,
  framexbottommargin=1pt,
  showstringspaces=false,
  keepspaces=true,
  aboveskip=6pt,
  belowskip=0pt
}

\lstdefinestyle{Result}{%
  basicstyle={\linespread{1.0}\small\ttfamily},%
  stringstyle={\small\ttfamily},
  showstringspaces=false,
  breaklines=true,
  xrightmargin=0\zw,%
  xleftmargin=4\zw,
  aboveskip=1pt,
  belowskip=2pt
}


% For Code Captions
\DeclareCaptionFormat{listing}{#1#2#3}
\captionsetup[lstlisting]{format=listing,singlelinecheck=false, margin=2\zw, font={sf},labelsep=quad,labelfont=bf}
\renewcommand\lstlistingname{Code}
